<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>JSON Test</title>

        <!-- Font -->
        <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
        <!-- FontAwesome Icons -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css" integrity="sha384-HzLeBuhoNPvSl5KYnjx0BT+WB0QEEqLprO+NBkkk5gbc67FTaL7XIGa2w1L0Xbgc" crossorigin="anonymous">
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
        <!-- Bootstrap Multiselct -->
        <link rel="stylesheet" href="css/bootstrap-multiselect.css" type="text/css" />
        <link href="css/caldisplay_vue.css" rel="stylesheet">
        <style>
            html, body {
                height: 100%;
            }
            label {
                font-size: 1em;
            }
            #app {
                height: 100%;
                background-color: #F0F0F0;
            }
            .row-cols-7>* {
                -ms-flex: 0 0 14.285714285714285714285714285714%;
                flex: 0 0 14.285714285714285714285714285714%;
                max-width: 14.285714285714285714285714285714%;
            }
            .bg-orange {
                background-color: #E95420;
                color: white;
            }
            
            /* SideBar Filtering */
            .sidebar-sticky {
                max-height: 700px;
                overflow: auto;
            }
            .filter-heading {
                font-size: 1.2em;
                -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;-o-user-select:none;
            }

            /* Multiselect */
            .filter-button {
                color: white;
                font-weight: 500;
                text-decoration: none;
                /* margin: .5rem 1rem; */
            }
            .btn-link:hover {
                color: white;
                text-decoration: none;
            }
            .multiselect-container>li>a>label {
                padding: 3px 20px 3px 10px;
                display: block;
                -webkit-box-align: unset;
                -webkit-align-items: unset;
                -ms-flex-align: unset;
                align-items: unset;
                -webkit-box-pack: unset;
                -webkit-justify-content: unset;
                -ms-flex-pack: unset;
                justify-content: unset;
                margin-bottom: unset;
            }
            #m-wa-category-choices + div > ul {
			    min-width: 11rem;
		    }
            #m-discipline-choices + div > ul {
			    min-width: 11rem;
		    }
            .fa-chevron-up {
                font-size: 0.7em;
            }
            .form-check-label {
                font-size: 1em;
            }
            .card-body {
                background-color: #da7652;
            }

            /* Year Filter */
            #selectedYear {
                color: #E95420;
                -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;-o-user-select:none;
            }
            #selectedYear>i {
                font-size: 0.8em;
            }
            #selectedYear>i:hover {
                color: #707070;
                cursor: pointer;
            }
            
            /* Month Filter */
            .month-heading {
                color: #707070;
                text-decoration: underline;
                -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;-o-user-select:none;
            }
            .month-heading:hover {
                color: #E95420;
                cursor: pointer;
            }
            /* Month Filter (table row) */
            .table-row-month {
                background-color: #F0F0F0;
            }

            /* LightBox Competition Details */
            .modal-header > h6 {
                font-size: 1rem;
            }

            /* Pagination */
            .page-item {
                cursor: pointer;
            }
            .page-link {
                -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;-o-user-select:none;
            }
            /* The animation code */
            @keyframes chevron-flip {
                0% {transform: rotate(0deg);}
                100% {transform: rotate(180deg);}
            }
            .chevron-animate-up {
                animation-name: chevron-flip;
                animation-iteration-count: 1;
                animation-duration: 0.4s;
                animation-fill-mode: forwards;
                animation-direction: normal;
            }
            .chevron-animate-down {
                animation-name: chevron-flip;
                animation-iteration-count: 1;
                animation-duration: 0.4s;
                animation-fill-mode: forwards;
                animation-direction: reverse;
            }
            .bd-placeholder-img {
                font-size: 1.125rem;
                text-anchor: middle;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }
            @media (min-width: 768px) {
                .bd-placeholder-img-lg {
                    font-size: 3.5rem;
                }
            }
            @media (min-width: 992px) {
                .row-cols-lg-7>* {
                    -ms-flex: 0 0 14.285714285714285714285714285714%;
                    flex: 0 0 14.285714285714285714285714285714%;
                    max-width: 14.285714285714285714285714285714%;
                }
            }
        </style>
        <!-- Custom styles for this template -->
    </head>
    <body>
        <div id="app">
        <!-- <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
            <a class="navbar-brand col-md-3 col-lg-2 mr-0 px-3" href="#">Company name</a>
            <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-toggle="collapse" data-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <input class="form-control form-control-dark w-100" type="text" placeholder="Search" aria-label="Search">
            <ul class="navbar-nav px-3">
                <li class="nav-item text-nowrap">
                <a class="nav-link" href="#">Sign out</a>
                </li>
            </ul>
        </nav> -->

            <div class="container-fluid">
                <div class="row">
                    <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse" style="background-color: #E95420;">
                        <div class="sidebar-sticky pt-3">
                            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                                <span class="text-white">Filter</span>
                                <!-- <a class="d-flex align-items-center text-muted" href="#" aria-label="Add a new report">
                                    <span data-feather="plus-circle"></span>
                                </a> -->
                            </h6>
                            
                            <div class="form-group">
                                <input class="form-control" v-model="name_search_query" type="text" placeholder="Search name">
                            </div>
                            <ul class="nav flex-column">
                                <li class="nav-item">
                                    <a class="filter-heading d-block text-white nav-link" role="button">
                                        Location <i class="fas fa-chevron-up"></i>
                                    </a>
                                    <div class="collapse">
                                        <div class="card card-body">
                                            <div class="form-group">
                                                <label for="country">Choose Country</label>
                                                <button type="button" class="btn btn-light btn-sm btn-block mb-2" @click="selectedCountries=[]">All locations</button>
                                                <select multiple v-model="selectedCountries" class="form-control">
                                                    <option disabled selected hidden>...</option>
                                                    <option v-for="option in country_options" :value="option">{{ option }}</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <select name="location" id="location-choices"  multiple="multiple"></select>
                                </li>
                                <li class="nav-item">
                                    <a class="filter-heading d-block text-white nav-link" role="button">
                                        WA Category <i class="fas fa-chevron-up"></i>
                                    </a>
                                    <div class="collapse">
                                        <div class="card card-body">
                                            <div class="form-group">
                                                <label for="country">Choose WA Category</label>
                                                <button type="button" class="btn btn-light btn-sm btn-block mb-2" @click="selectedWACategories=[]">All categories</button>
                                                <div v-for="(cat, i) in waCategories" class="form-group form-check">
                                                    <input class="form-check-input" type="checkbox" :value="cat.value" :id="'id-wacategory-' + i" v-model="selectedWACategories">
                                                    <label class="form-check-label" :for="'id-wacategory-' + i">{{ cat.code }}</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <select name="wa-category" id="wa-category-choices"  multiple="multiple"></select>
                                </li>
                                <!-- <li class="nav-item">
                                    <a class="filter-heading d-block text-white nav-link" role="button">
                                        Competition <i class="fas fa-chevron-up"></i>
                                    </a>
                                    <div class="collapse">
                                        <div class="card card-body">
                                            <button type="button" class="btn btn-light btn-sm btn-block mb-2" @click="selectedCategories=[]">All competitions</button>
                                            
                                            <div v-for="(cat, i) in compCategories" class="form-group form-check">
                                                <input class="form-check-input" type="checkbox" :value="cat.value" :id="'id-category-' + i" v-model="selectedCategories">
                                                <label class="form-check-label" :for="'id-category-' + i">{{ cat.label }}</label>
                                            </div>
                                        </div>
                                    </div>
                                </li> -->
                                <li class="nav-item">
                                    <a class="filter-heading d-block text-white nav-link" role="button">
                                        Discipline <i class="fas fa-chevron-up"></i>
                                    </a>
                                    <div class="collapse">
                                        <div class="card card-body">
                                            <button type="button" class="btn btn-light btn-sm btn-block mb-2" @click="selectedCompType=[]">All Disciplines</button>

                                            <div v-for="(type, i) in compTypes" class="form-group form-check">
                                                <input class="form-check-input" :value="type.value" :id="'id-type-' + i" type="checkbox" v-model="selectedCompType">
                                                <label class="form-check-label" :for="'id-type-' + i">{{ type.label }}</label>
                                            </div>
                                        </div>
                                    </div>
                                    <select name="discipline" id="discipline-choices"  multiple="multiple"></select>
                                </li>
                                <li class="nav-item">
                                    <a class="filter-heading d-block text-white nav-link" role="button">
                                        Age Groups <i class="fas fa-chevron-up"></i>
                                    </a>
                                    <div class="collapse">
                                        <div class="card card-body">
                                            <button type="button" class="btn btn-light btn-sm btn-block mb-2" @click="selectedAG=[]">All Age Groups</button>
                                            
                                            <div v-for="(ag, i) in ageGroups" class="form-group form-check">
                                                <input class="form-check-input" :value="ag.value" :id="'id-ag-' + i" type="checkbox" v-model="selectedAG">
                                                <label class="form-check-label" :for="'id-ag-' + i">{{ ag.label }}</label>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </nav>

                    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center ">
                            <div id="selectedYearContainer" class="mx-auto">
                                <h1 id="selectedYear" class="d-inline">
                                    <i class="fas fa-angle-left mx-2" @click="decrementYear()"></i>
                                    {{ selectedYear }}
                                    <i class="fas fa-angle-right mx-2" @click="incrementYear()"></i>
                                </h1>
                            </div>
                            <!-- <div class="btn-toolbar mb-2 mb-md-0 d-none d-md-block" style="position: absolute;right:20px;">
                                <div class="btn-group mr-2">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" data-toggle="collapse" data-target="#eventDays" aria-expanded="false" aria-controls="eventDays">Calendar View</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary">Map View</button>
                                </div>
                            </div> -->
                        </div>

                        <!-- Toggles show/hide of filters -->
                        <a class="btn btn-primary btn-sm d-sm-block d-md-none mb-1" data-toggle="collapse" href="#mobileFilter" role="button" aria-expanded="false" aria-controls="mobileFilter">
                            <i class="fas fa-filter"></i>
                        </a>

                        <!-- Data is injected into multiselct through 'initialiseMultiSelect' -->
                        <div id="mobileFilter" class="collapse">
                            <select name="location" id="m-location-choices"  multiple="multiple"></select>
                            <select name="wa-category" id="m-wa-category-choices"  multiple="multiple"></select>
                            <select name="discipline" id="m-discipline-choices"  multiple="multiple"></select>
                            <select name="age_group" id="m-age-group-choices"  multiple="multiple"></select>
                        </div>

                        <!-- Shows each month -->
                        <div id="months-headings" class="d-none d-md-flex row pt-3 pb-2 mb-3 border-bottom">
                            <div class="col-md-1 d-md-inline" v-for="month in months_data" >
                                <h5 class="month-heading d-block mb-0 text-center" v-on:click="applyDateFilter(month)">{{ month.name }}</h5>
                                <div class="d-block mx-auto" style="width:fit-content">
                                    <span class="badge badge-pill badge-secondary">{{ month.numberOfComps }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Shows each day of each month -->
                        <div id="eventDays" class="row row-cols-7 collapse">
                            <div class="col p-3" v-for="n in 42">
                                <div class="border border-dark">
                                    <h3>{{ n }}</h3>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex flex-horizontal justify-content-between align-items-center">
                            <div>
                                <span v-if="filteredCompetitions" class="badge badge-secondary mb-0">{{ filteredCompetitions.length || 0 }} of {{ info && info.length || 0 }} competitions</span>
                                <a class="d-block d-md-inline" href="javascript:location.reload(true)">Reset filters</a>
                            </div>
                            <navigator class="float-right" :is-loading="isLoading" :total="filteredCompetitions && filteredCompetitions.length || 0" @movePage="mvPg" @changePage="setPg" :results-per-page="showOnPage"></navigator>
                        </div>
                        <div class="table-responsive">
                            <table id="competitionTable" class="table table-sm list bg-white">
                                <thead class="bg-primary text-white">
                                    <tr>
                                        <th scope="col" class="d-lg-table-cell">Date</th>
                                        <th scope="col">Full Name</th>
                                        <th class="d-none d-lg-table-cell text-center" scope="col">Age Groups</th>
                                        <th class="d-none d-lg-table-cell text-center" scope="col">WA Cat</th>
                                        <th class="d-none d-lg-table-cell text-center" scope="col">Country</th>
                                        <th class="text-center" scope="col">Discipline</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-if="paginatedCompetitions().length == 0">
                                        <td>No competitions</td>
                                    </tr>
                                    <tr v-for="comp in paginatedCompetitions()"  :key="comp.id">
                                        <td style="width:125px">{{comp.date}}</td>
                                        <td><a href="" @click="showCompetitionDetails(comp)" data-toggle="modal" data-target="#competitionDetailModel">{{comp.full_name}}</a></td>
                                        <td class="d-none d-lg-table-cell text-center">{{comp.age_groups}}</td>
                                        <td class="d-none d-lg-table-cell text-center">{{ getCategoryCode(comp.wa_rankings_category) }}</td>
                                        
                                        <td class="d-none d-lg-table-cell text-center">{{comp.country}}</td>
                                        <td class="text-center">{{comp.type}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <nav class="d-flex justify-content-center">
                            <navigator class="float-right" :is-loading="isLoading" :total="filteredCompetitions && filteredCompetitions.length || 0" @movePage="mvPg" @changePage="setPg" :results-per-page="showOnPage"></navigator>
                        </nav>
                    </main>
                </div>
            </div>
        
            <!-- Modal -->
            <div class="modal fade" id="competitionDetailModel" tabindex="-1" aria-labelledby="competitionDetailModel" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="competitionDetailName">{{ selectedCompetition.full_name }} <h6 v-if="selectedCompetition.name_local != ''" class="blockquote-footer my-auto mx-2">{{ selectedCompetition.name_local }}</h6></h5>
                            
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col">{{ selectedCompetition.basic_description }}</div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <ul class="list-group">
                                        <li class="list-group-item">Contact Name <h5><span class="badge badge-primary badge-pill">{{ selectedCompetition.contact_name }}</span></h5></li>
                                        <li class="list-group-item">Contact Details <h5><span class="badge badge-primary badge-pill">{{ selectedCompetition.contact_details }}</span></h5></li>
                                        <li class="list-group-item d-flex align-items-center">
                                            <p class="mr-auto my-0">Competitors</p>
                                            <a v-if="selectedCompetition.ot_supported" href="" class="px-3">Click here</a>
                                            <span class="badge badge-primary badge-pill">{{ selectedCompetition.num_competitors }}</span>
                                        </li>
                                        <li class="list-group-item d-flex align-items-center">
                                            <p class="mr-auto my-0">Results</p>
                                            <a v-if="selectedCompetition.ot_supported" href="" class="px-3">Click here</a>
                                            <a v-else href="selectedCompetition.results_link" class="px-3">Click here</a>
                                            <span class="badge badge-primary badge-pill">{{ selectedCompetition.num_results }}</span>
                                        </li>
                                        <li v-if="selectedCompetition.website != ''" class="list-group-item d-flex align-items-center">
                                            <p class="mr-auto my-0">Website</p>
                                            <a  :href="selectedCompetition.website" class="px-3">Click here</a>
                                            <span class="badge badge-primary badge-pill invisible">44</span>
                                        </li>
                                      </ul>
                                </div>
                                <div class="col">
                                    <div id="map" class="w-100" style="height:300px"></div>
                                </div>
                            </div>
                            
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Navigator -->
        <script type="text/template" id="navigator_template">
            <ul class="pagination mr-0 my-1" v-if="isLoading || total > resultsPerPage" v-cloak>
                <li :class="{'page-item': true, disabled: $parent.page == 0}">
                    <a class="page-link" @click="prevPage" aria-label="Previous">
                        <span aria-hidden="true" class="d-none d-lg-inline-block hidden-xs hidden-sm hidden-md">Prev</span>
                        <span class="d-inline-block d-lg-none hidden-lg">&laquo;</span>
                    </a>
                </li>
                <!--  partial -->
                <li v-if="numPages > threshold && $parent.page > 2" :class="{'page-item': true, active: $parent.page == 1}"><a class="page-link" @click="setPage(1)">1</a></li>
                <li v-if="numPages > threshold && $parent.page > 3" class="page-item disabled"><span class="page-link">...</span></li>
                <li v-if="numPages > threshold" v-for="pi in _.range(Math.max(1, $parent.page - 1), Math.min(numPages, $parent.page + 2) + 1)"
                    :class="{'page-item': true, active: $parent.page == pi}">
                    <a @click="setPage(pi)" class="page-link">{{ pi }}</a>
                </li>
                <li v-if="numPages > threshold && $parent.page < numPages - 3" class="page-item disabled"><span class="page-link">...</span></li>
                <li v-if="numPages > threshold && $parent.page < numPages - 2" class="page-item"><a class="page-link" @click="setPage(numPages)">{{ numPages }}</a></li>
                <li v-else-if="numPages <= threshold" v-for="i in _.range(1, numPages+1)" :class="{'page-item': true, active: $parent.page == i}">
                    <a @click="setPage(i)" class="page-link">{{ i }}</a>
                </li>
                <li :class="{'page-item': true, disabled: $parent.page == numPages}">
                    <a class="page-link" @click="nextPage" aria-label="Next">
                        <span aria-hidden="true" class="d-none d-lg-inline-block hidden-xs hidden-sm hidden-md">
                            <span v-if="isLoading"><img src="./img/ajax-loading.gif" alt="Loading" /> Loading ...</span>
                            <span v-else>Next</span>
                        </span>
                        <span class="d-inline-block d-lg-none hidden-lg">
                            <span v-if="isLoading"><img src="./img/ajax-loading.gif" alt="Loading" /> Loading ...</span>
                            <span v-else>&raquo;</span>
                        </span>
                    </a>
                </li>
            </ul>
        </script>
        <!-- Bootstrap JS, Popper.js, and jQuery -->
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
        
        <!-- Bootstrap Multiselct JS -->
        <script type="text/javascript" src="./js/bootstrap-multiselect.js"></script>
        
        <!-- Google Maps API -->
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDNwYdWaTG9yfjZydsHKW3tnm-rn8f30sw&libraries=places"></script>
        <!-- Vue -->
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <!-- Axios -->
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <!-- Lodash -->
        <script src="./js/lodash.js"></script>
        <!-- Paginator JS -->
        <script src="./js/navigator-script.js"></script>
        <script>
            $(document).ready(() => {
                // Handles toggling of show/hide animations for filter options
                // Toggles the collapse of filters
                $(".filter-heading.d-block.text-white").click(function(){
                    $(this).next().collapse('toggle');
                });
                $('.collapse').on('show.bs.collapse', function() {
                    var chevron = $(this).prev().children('i');
                    chevron.addClass('chevron-animate-up');
                    setTimeout(() => {
                        chevron.removeClass('chevron-animate-down');
                        var rotate = chevron.css('transform');
                        chevron.css('transform', rotate);
                        chevron.removeClass('chevron-animate-up');
                    }, 500);
                });
                $('.collapse').on('hide.bs.collapse', function() {
                    var chevron = $(this).prev().children('i');
                    chevron.addClass('chevron-animate-down');
                    setTimeout(() => {
                        chevron.removeClass('chevron-animate-up');
                        var rotate = chevron.css('transform');
                        chevron.css('transform', rotate);
                        chevron.removeClass('chevron-animate-down');
                    }, 500);
                });
            });

            var app = new Vue({
                el: '#app',
                props: {
                    waCategories: {
                        type: Array,
                        default: function() {
                            return [{label:'Olympic Games & World Championships', code:'OW', value:1}, {label:'Diamond League Finals', code:'DF', value:2}, {label:'World specialist championships (e.g. indoor), DLs', code:'GW', value:3}, {label:'Platinum and Gold Label', code:'GL', value:4}, {label:'Major Games, WACT Gold', code:'A', value:5}, {label:'WACT Silver, ETCH, National Champs', code:'B', value:6}, {label:'WA U20, WACT Bronze, Area 3rd Tier', code:'C', value:7}, {label:'Traditional International, National Senior Indoor', code:'D', value:8}, {label:"Int'l Matches, Selected National Meetings", code:'E', value:9}, {label:'International Meetings with National Permit', code:'F', value:10}, {label:'Unclassified but of international interest', code:'U', value:11}];
                        } 
                    },
                    compCategories: {
                        type: Array,
                        default: function() {
                            return [{label:'European athletics events and meetings', value:'cat-1'}, {label:'IAAF events and meetings', value:'cat-2'}, {label:'Affiliated organisation competitions', value:'cat-3'}, {label:'International matches', value:'cat-4'}, {label:'National championships', value:'cat-5'}, {label:'International meetings with national permit', value:'cat-6'}];
                        }
                    },
                    ageGroups: {
                        type: Array,
                        default: function () {
                            return [{label:'Seniors',value:'SEN'}, {label:'Masters',value:'M'}, {label:'U23',value:'U23'}, {label:'U20',value:'U20'}, {label:'U18',value:'U18'}]
                        }
                    },
                    compTypes: {
                        type: Array,
                        default: function () {
                            return [{label:'Outdoor', value:'TRACK'}, {label:'Indoor', value:'INDOOR'}, {label:'Road races', value:'ROAD'}, {label:'Cross country', value:'XC'}, {label:'Mountain running', value:'MOUNTAIN'}, {label:'Race walking', value:'WALK'}]
                        }
                    },
                    allMonths: {
                        type: Array,
                        default: function () {
                            return ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC']
                        }
                    },
                    pageSize: {
                        type: Number,
                        default: function () { return 50 }
                    }
                },
                data() {
                    return {
                        info: [],
                        name_search_query: '',
                        all_months: [],
                        country_options: [],
                        selectedYear: new Date().getFullYear(),
                        selectedMonths: [],
                        selectedCompType: [],
                        selectedAG: [],
                        selectedCountries: [],
                        selectedWACategories: [],
                        selectedCategories: [],
                        
                        selectedCompetition: {},

                        map: {},
                        mapFinder: {},
                        

                        showOnPage: 16,
                        page: 1,
                        isLoading: true,
                    }
                },
                computed: {
                    filteredCompetitions: function () {
                        var self = this,
                            output = self.info || [];

                        if (self.name_search_query != '') {
                            output = output.filter(function (item) {
                                return item.full_name.toLowerCase().includes(self.name_search_query.toLowerCase())
                            })
                        }
                        if (self.selectedCountries.length > 0) {
                            output = output.filter(function (item) {
                                return self.selectedCountries.indexOf(item.country) >= 0
                            })
                        }
                        if (self.selectedCompType.length > 0) {
                            output = output.filter(function (item) {
                                return self.selectedCompType.indexOf(item.type) >= 0
                            })
                        }
                        if (self.selectedAG.length > 0) {
                            output = output.filter(function (item) {
                                var ageGroups = item.age_groups.split(',').map(function(ag) { return ag.trim() });
                                var hits = ageGroups.map(function (ag) {
                                    return self.selectedAG.indexOf(ag) >= 0
                                })
                                return hits.reduce(function (x, y) { return x || y }, false)
                            })
                        }
                        if (self.selectedYear) {
                            output = self.filterByDate(null, output)
                        }
                        if (self.selectedMonths.length > 0) {
                            var list = [];
                            self.selectedMonths.forEach(month => list = list.concat(self.filterByDate(month.string, output)));
                            output = list;
                        }
                        if (self.selectedWACategories.length > 0) {
                            output = output.filter(function (item) {
                                return self.selectedWACategories.indexOf(item.wa_rankings_category) >= 0
                            })
                        }
                        return output
                    },
                    months_data: function() {
                        var self = this;
                        self.all_months = [];
                        if (self.info) {
                            for (month in self.allMonths) {
                                var monObject = {
                                    num: parseInt(month)+1,
                                    name: self.allMonths[month],
                                    string: String(parseInt(month)+1).padStart(2, '0')
                                };
                                var compList = self.filterByDate(monObject.string);
                                monObject.numberOfComps = compList.length;
                                self.all_months.push(monObject);
                            }
                        }
                        var output = self.all_months;
                        return output;
                    }
                },
                methods:{
                    incrementYear: function() {
                        var self = this;
                        self.selectedYear++;
                        self.fetchData();
                    },
                    decrementYear: function() {
                        var self = this;
                        self.selectedYear--;
                        self.fetchData();
                    },
                    applyDateFilter: function(month) {
                        var self = this;

                        // Check if month is contained in list
                        if (self.selectedMonths.some(e => e === month)) {
                            // Remove it
                            var selMonths = self.selectedMonths;
                            self.selectedMonths = selMonths.filter((mon) => mon.num != month.num);
                            self.removeMonthInTable(month);
                        } else {
                            // Add it
                            self.selectedMonths.push(month);
                            self.insertMonthInTable();
                        }
                        self.displaySelectedMonths();
                    },
                    displaySelectedMonths: function() {
                        var self = this;
                        // Diplays which month is currently being filtered by
                        var calMonths = document.getElementById('months-headings');
                        Array.from(calMonths.children).forEach(mon => mon.children[0].style.color = "#707070");

                        self.selectedMonths.forEach((month) => {
                            var clickedMonth = calMonths.children[month.num-1];
                            clickedMonth.children[0].style.color = "#E95420";
                        });
                    },

                    insertMonthInTable: function() {
                        var self = this;
                        var competitions = self.paginatedCompetitions();
                        // console.log("Insert");
                        // console.log(competitions);

                        // var month = self.selectedMonths.slice(-1)[0];
                        var totalNumberOfcomps = 0;
                        var rowPosition = 0;
                        var addedMonths = [];

                        // Clear table of months first
                        self.clearMonthsInTable();
                        for (const month of self.selectedMonths) {
                            var html =  `<tr class="table-row-month"><th scope="row" colspan="6">${month.name}</th></tr>`;
                            var monthIndex = self.selectedMonths.indexOf(month);

                            // Inserts months selected after first
                                // console.log(competitions.length, month.numberOfComps);
                                // insertRowLocation = (preMonthCompLength);
                            if (monthIndex > 0) {
                                rowPosition = totalNumberOfcomps+(monthIndex-1);
                            }
                            // console.log(totalNumberOfcomps);
                            for (const comp in competitions) {
                                var number = parseInt(comp)+1;
                                // console.log(addedMonths.indexOf(month) == -1);
                                // console.log(competitions[comp].date.match(`${self.selectedYear}-${month.string}`));

                                if (addedMonths.indexOf(month) == -1 && competitions[comp].date.match(`${self.selectedYear}-${month.string}`)) {
                                    // console.log("inserting row");
                                    // console.log(rowPosition);
                                    if (addedMonths.length != 0) {
                                        $('#competitionTable > tbody > tr').eq(rowPosition).after(html);
                                    } else {
                                        $('#competitionTable > tbody > tr').eq(0).before(html);
                                    }
                                    addedMonths.push(month);               
                                }
                            }
                            totalNumberOfcomps += self.filterByDate(month.string, competitions).length;
                        
                        }
                    },
                    clearMonthsInTable: function() {
                        var self = this;
                        $('#competitionTable > tbody').children('tr').each((i, element) => {
                            for (const month of self.selectedMonths) {
                                if ($(element).text() == month.name) {
                                    $(element).remove();
                                }
                            }
                        });
                    },
                    removeMonthInTable: function(month) {
                        var self = this;
                        $('#competitionTable > tbody').children('tr').each((i, element) => {
                            if ($(element).text() == month.name) {
                                $(element).remove();
                            }
                        });
                        self.insertMonthInTable();
                    },

                    filterByDate: function(month, data) {
                        var output, self=this;
                        if (data) {
                            output = data;
                        } else {
                            output = this.info;
                        }
                        if (month) {
                            var result = output.filter((item)=>{
                                // Need to change this to selectedYear
                                return item.date.match(`${self.selectedYear}-${month}`);
                            })
                            // console.log(result);
                            return result;
                        } else {
                            return output.filter((item)=>{
                                // Need to change this to selectedYear
                                return item.date.match(`${self.selectedYear}`);
                            })
                        }
                    },
                    getCategoryCode: function(number) {
                        var self = this;
                        var output = self.waCategories.find(item => item.value == number)
                        return output.code;
                    },

                    // Show competition detail when clicked on competition
                    showCompetitionDetails: function(comp) {
                        var self = this;
                        self.selectedCompetition=comp;
                        // console.log(self.map);
                        if (self.selectedCompetition.address != "") {
                            $('#map').show();
                            self.updateMap(self.selectedCompetition.address);
                        } else {
                            $('#map').hide();
                        }
                    },

                    // Google maps methods
                    initMap: function() {
                        var self = this;
                        self.map = new google.maps.Map(document.getElementById("map"), {
                            center: null,
                            zoom: 8,
                        });
                        self.mapFinder = new google.maps.places.PlacesService(self.map);
                    },
                    updateMap: function(address) {
                        var self = this;
                        self.findPlace(address);
                    },
                    findPlace: function(address) {
                        var self = this;
                        const request = {
                            query: address,
                            fields: ["name", "geometry"],
                        };
                        self.mapFinder.findPlaceFromQuery(request, (results, status) => {
                            if (status === google.maps.places.PlacesServiceStatus.OK) {
                                self.map.setCenter(results[0].geometry.location);
                                self.createMarker(results[0]);
                            }else {
                                console.log("Google Maps: Could not get location");
                            }
                        });
                    },
                    createMarker: function(place) {
                        var self = this, map = self.map;
                        const marker = new google.maps.Marker({
                            map,
                            position: place.geometry.location,
                        });
                    },

                    // Initialisation of multiselect filtering buttons
                    initialiseMultiSelect: function() {
                        var self = this;
                        // Multiselect Buttons

                        var locationMultiselectConfig = {
                            buttonClass: 'btn btn-primary btn-sm mb-2',
                            includeSelectAllOption: true,
                            selectAllValue: 'ALL',
                            selectAllText: 'All countries',
                            allSelectedText: '(All countries)',
                            // nonSelectedText: 'Age groups (none)',
                            maxHeight: 200,

                            numberDisplayed: 1,
                            buttonText: function(options, select) {
                                if (options.length == 1) {
                                    return options.html();
                                }
                                else {
                                    return `Countries (${options.length})`;
                                }
                            },
                            onChange: function(option, checked, select) {
                                console.log(checked)
                                if (checked) {
                                    self.selectedCountries.push(option.val());
                                } else {
                                    self.selectedCountries = _.remove(self.selectedCountries, v => v != option.val())
                                }
                                console.log(self.selectedCountries)
                            }
                        };

                        var waCategoryMultiselectConfig = {
                            buttonClass: 'btn btn-primary btn-sm mb-2',
                            includeSelectAllOption: true,
                            selectAllValue: 'ALL',
                            selectAllText: 'All categories',
                            allSelectedText: '(All categories)',
                            // nonSelectedText: 'Age groups (none)',
                            maxHeight: 200,

                            numberDisplayed: 1,
                            buttonText: function(options, select) {
                                if (options.length == 1) {
                                    return options.html();
                                }
                                else {
                                    return `WA Categories (${options.length})`;
                                }
                            },
                            onChange: function(option, checked, select) {
                                console.log(checked)
                                if (checked) {
                                    self.selectedWACategories.push(option.val());
                                } else {
                                    self.selectedWACategories = _.remove(self.selectedWACategories, v => v != option.val())
                                }
                                console.log(self.selectedWACategories)
                            }
                        }

                        var disciplineMultiselectConfig = {
                            buttonClass: 'btn btn-primary btn-sm mb-2',
                            includeSelectAllOption: true,
                            selectAllValue: 'ALL',
                            selectAllText: 'All disciplines',
                            allSelectedText: '(All disciplines)',
                            // nonSelectedText: 'Age groups (none)',
                            maxHeight: 200,

                            numberDisplayed: 1,
                            buttonText: function(options, select) {
                                if (options.length == 1) {
                                    return options.html();
                                }
                                else {
                                    return `Disciplines (${options.length})`;
                                }
                            },
                            onChange: function(option, checked, select) {
                                console.log(checked)
                                if (checked) {
                                    self.selectedCompType.push(option.val());
                                } else {
                                    self.selectedCompType = _.remove(self.selectedCompType, v => v != option.val())
                                }
                                console.log(self.selectedCompType)
                            }
                        }


                        // Mobile multiselect
                        $('#m-location-choices').multiselect(locationMultiselectConfig);
                        // Desktop multiselect
                        var desktopLocationMultiselectConfig = locationMultiselectConfig;
                        desktopLocationMultiselectConfig.buttonClass = 'btn btn-link filter-button d-none';
                        $('#location-choices').multiselect(desktopLocationMultiselectConfig);


                        // Mobile multiselect
                        $('#m-wa-category-choices').multiselect(waCategoryMultiselectConfig);
                        // Desktop multiselect
                        var desktopwaCategoryMultiselectConfig = waCategoryMultiselectConfig;
                        desktopwaCategoryMultiselectConfig.buttonClass = 'btn btn-link filter-button d-none';
                        $('#wa-category-choices').multiselect(desktopwaCategoryMultiselectConfig);

                        // Mobile multiselect
                        $('#m-discipline-choices').multiselect(disciplineMultiselectConfig);
                        // Desktop multiselect
                        var desktopdisciplineMultiselectConfig = disciplineMultiselectConfig;
                        desktopdisciplineMultiselectConfig.buttonClass = 'btn btn-link filter-button d-none';
                        $('#discipline-choices').multiselect(desktopdisciplineMultiselectConfig);




                        $('#m-discipline-choices').multiselect();
                        $('#m-age-group-choices').multiselect({
                            buttonClass: 'btn btn-primary btn-sm mb-2',
                            includeSelectAllOption: true,
                            selectAllValue: 'ALL',
                            selectAllText: 'All age groups',
                            allSelectedText: '(All age groups)',
                            // nonSelectedText: 'Age groups (none)',
                            maxHeight: 200,

                            numberDisplayed: 1,
                            buttonText: function(options, select) {
                                if (options.length == 1) {
                                    return options.html();
                                }
                                else {
                                    return `Age groups (${options.length})`;
                                }
                            },
                            onChange: function(option, checked, select) {
                                console.log(checked)
                                if (checked) {
                                    self.selectedAG.push(option.val());
                                } else {
                                    self.selectedAG = _.remove(self.selectedAG, v => v != option.val())
                                }
                                console.log(self.selectedAG)
                            }
                        });


                        var country_options = [];
                        self.country_options.forEach(c => country_options.push({label: c, value: c}));
                        $('#location-choices').multiselect('dataprovider', country_options);
                        $('#m-location-choices').multiselect('dataprovider', country_options);
                        

                        var wa_category_options = [];
                        self.waCategories.forEach(c => wa_category_options.push({label: c.code, value: c.value, title: c.label}));
                        $('#wa-category-choices').multiselect('dataprovider', wa_category_options);
                        $('#m-wa-category-choices').multiselect('dataprovider', wa_category_options);

                        var type_options = [];
                        self.compTypes.forEach(t => type_options.push({label: t.label, value: t.value}));
                        $('#discipline-choices').multiselect('dataprovider', type_options);
                        $('#m-discipline-choices').multiselect('dataprovider', type_options);

                        var age_group_options = [];
                        self.ageGroups.forEach(ag => age_group_options.push({label: ag.label, value: ag.value}));
                        $('#m-age-group-choices').multiselect('dataprovider', age_group_options);

                    },

                    // Pagination methods
                    setPg: function (p) {
                        this.page = p
                    },
                    mvPg: function (i) {
                        this.page += i
                    },
                    maxPages: function () {
                        var self = this,
                            total = self.filteredCompetitions.length;
                        return Math.max(1, Math.ceil(total / self.showOnPage))
                    },
                    pageStartIdx: function () {
                        var self = this,
                            maxPages = self.maxPages();
                        if (self.page > maxPages)
                            self.page = maxPages;
                        return (self.page-1) * self.showOnPage + 1;
                    },
                    pageEndIdx: function () {
                        var self = this;
                        return Math.min(self.pageStartIdx() + self.showOnPage - 1, self.filteredCompetitions.length)
                    },
                    paginatedCompetitions: function () {
                        var self = this,
                            start = self.pageStartIdx() - 1;
                        return self.filteredCompetitions.slice(start, start + self.showOnPage)
                    },


                    fetchData: function() {
                        var self = this;
                        self.isLoading = true;
                        axios
                        .get(`https://file.opentrack.run/live/euroath/european_calendar_${self.selectedYear}.json`)
                        .then(response => {
                            self.info = response.data;
                            // console.log(self.info);
                            self.country_options = self.info.map(item => item.country
                                                ).filter((value, index, list) => list.indexOf(value) === index);
                            self.isLoading = false; 

                            self.initMap();   

                            self.initialiseMultiSelect();                    
                        })
                    }
                },
                watch: {
                    page: function() {
                        var self = this;
                        console.log("change");
                        setTimeout(function(){ self.insertMonthInTable(); }, 50);
                    },
                    filteredCompetitions: function() {
                        var self = this;
                        console.log("change");
                        setTimeout(function(){ self.insertMonthInTable(); }, 50);
                    }
                },
                mounted() {
                    var self = this;
                    self.fetchData();
                }
            })
        </script>
    </body>
</html>
